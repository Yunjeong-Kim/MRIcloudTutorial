---
title: "Long versus wide format"
author: "Brian Caffo"
date: "April 19, 2017"
output: ioslides_presentation
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, comment = "")
```

## Load in the sample data

```{r, eval=FALSE}
## Only if you don't have the package installed
source("https://neuroconductor.org/neurocLite.R")
neuro_install("MRIcloudT1volumetrics")
```

## reading in the data

```{r, warning = FALSE, message = FALSE}
library(MRIcloudT1volumetrics)
## Change this to where the data directory is
roiDir = "~/sandboxes/MRIcloudTutorial/data/"
fileList = dir(roiDir, full.names = TRUE)
# by default reads level 5
dat = readFileList(fileList, level = 1) %>% 
  select(roi, volume, id)
```

## Long versus wide format

- An important organizational principle for ROI data is long versus wide format
- Long formats are often useful for analysis software, like multilevel models
- Wide formats are more compact and useful for data manipulation


## Long format
The data is currently in a long format
```{r, echo = FALSE}
dat
```


## Wide format

Showing the first 5 columns (otherwise I run out of room)

```{r}
library(tidyr)
spread(dat, roi, volume)[,1:5]
```

## Conversions

- R has several wide to long and vice-versa converters
- Notable is the `reshape2` pacage and `tidyr`
- Also is the `reshape` function (which has nothing to do with `reshape2`)
- We're recommending `tidyr` 
    - `gather` converts from wide to long
    - `spread` converts from long to wide

## long to wide again

```{r}
wide = spread(dat, roi, volume)
```

- `dat` the data frame
- `roi` the name of column variables
- `volume` the value of the columns

## Note
- Note you can't have duplicates since `spread` then can't figure out what to do
- The following (not evaluated) gives and error since there's duplicate subjects

```{r, echo = TRUE, eval = FALSE}
tempDat = rbind(dat, dat)
spread(tempDat, roi, volume
```


## wide back to long

```{r}
gather(wide, roi, volume, CSF:Telencephalon_R) %>%
    arrange(subject)
```


